slice:
  id: SP_002
  name: "Phase 1 — Database Layer (F01-DB)"
  started: 2026-02-24
  target: 2026-03-07
  goal: >
    SQLite database schema opzetten met sqlite-vec extensie voor vector search.
    Sources + chunks tabellen, per-model vec tables (ensure_vec_table), FTS5 BM25
    full-text search, source_summaries tabel, forward-only migration runner en
    repository pattern implementeren. Fundament voor alle ingest + retrieval.

workitems:
  - id: WI_0012
    title: "Verbindingslaag + schema: sources + chunks tabellen"
    type: digital
    status: pending
    description: >
      SQLite verbinding opzetten met sqlite-vec extensie. Sources tabel:
      id (UUID TEXT PK), path (TEXT relatief), content_hash (TEXT SHA-256),
      embedding_model (TEXT), ingested_at (DATETIME). Chunks tabel:
      rowid (INTEGER implicit PK), source_id (FK), chunk_index (INT),
      text (TEXT), context_prefix (TEXT), metadata (JSON), created_at (DATETIME).
      schema_version tabel voor migration tracking.

  - id: WI_0012a
    title: "Per-model sqlite-vec virtual tables (ensure_vec_table)"
    type: digital
    status: pending
    depends_on: [WI_0012]
    description: >
      ensure_vec_table(model_slug, dimensions) implementeren — maakt
      vec_chunks_{model_slug} aan als nog niet bestaat. Naam bijv.
      vec_chunks_openai_text_embedding_3_small. rowid = chunks.rowid (native
      sqlite-vec mapping). Niet migration-managed.

  - id: WI_0012b
    title: "FTS5 virtual table voor BM25 full-text search"
    type: digital
    status: pending
    depends_on: [WI_0012]
    description: >
      chunks_fts FTS5 virtual table aanmaken. rowid = chunks.rowid (native
      FTS5 content table mapping). BM25 search via MATCH operator.

  - id: WI_0012c
    title: "source_summaries tabel"
    type: digital
    status: pending
    depends_on: [WI_0012]
    description: >
      source_summaries tabel: source_id (FK → sources.id), summary_text (TEXT),
      generated_at (DATETIME). Ophaalbaar per source_id.

  - id: WI_0013
    title: "Migration runner (forward-only, geen rollbacks)"
    type: digital
    status: pending
    depends_on: [WI_0012, WI_0012a, WI_0012b, WI_0012c]
    description: >
      Embedded Python migration runner: MIGRATIONS = [(version, sql), ...].
      schema_version tabel bijhouden. Idempotent: twee keer uitvoeren = zelfde staat.
      Beheert alleen statische tabellen — vec tables zijn model-managed (niet hier).

  - id: WI_0015
    title: "Repository pattern: chunk CRUD + FTS5 search + vec lookup + summaries"
    type: digital
    status: pending
    depends_on: [WI_0013]
    description: >
      Repository klasse voor alle database operaties: chunk insert/get/delete,
      source insert/get, FTS5 BM25 search, vec lookup (rowid mapping),
      source_summaries CRUD. Vec lookups via: SELECT c.* FROM chunks c WHERE
      c.rowid = vec_result.rowid. Retrieval geeft (chunk, score) tuples terug.

metrics:
  velocity_target: 6
  completed_this_slice: 0
  carry_over_previous: 0
